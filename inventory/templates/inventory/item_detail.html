{% extends 'base.html' %}

{% block title %}{{ item.item_id }} Details{% endblock %}

{% block content %}
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">Item Details: {{ item.item_id }}</h4>
            <div>
                <a href="{% url 'edit_item' item.pk %}" class="btn btn-secondary btn-sm">Edit</a>
                <a href="{% url 'delete_item' item.pk %}" class="btn btn-danger btn-sm">Delete</a>
            </div>
        </div>
        <div class="card-body">
            <p><strong>Category:</strong> {{ item.get_category_display }}</p>
            <p><strong>Description:</strong> {{ item.description }}</p>
            <p><strong>Vendor:</strong> {{ item.vendor }}</p>
            <p><strong>Rating:</strong> {{ item.rating }}</p>
            <p><strong>Location:</strong> {{ item.location }}</p>
            <p><strong>Status:</strong> {{ item.status.name|default:"N/A" }}</p>

            <hr>
            <h5>Specific Details</h5>

            {% if item.category == "Pump" %}
                <p><strong>Speed:</strong> {{ item.pump.speed }}</p>
                <p><strong>Inlet:</strong> {{ item.pump.inlet }}</p>
                <p><strong>Outlet:</strong> {{ item.pump.outlet }}</p>
                <p><strong>Material:</strong> {{ item.pump.moc }}</p>
                <p><strong>Power:</strong> {{ item.pump.power }}</p>
            {% elif item.category == "Valve" %}
                <p><strong>Material:</strong> {{ item.valve.moc }}</p>
                <p><strong>Size:</strong> {{ item.valve.size }}</p>
                <p><strong>Valve Type:</strong> {{ item.valve.valve_type }}</p>
            {% elif item.category == "Filter" %}
                <p><strong>Inlet:</strong> {{ item.filter.inlet }}</p>
                <p><strong>Outlet:</strong> {{ item.filter.outlet }}</p>
                <p><strong>Material:</strong> {{ item.filter.moc }}</p>
                <p><strong>Filter Type:</strong> {{ item.filter.filter_type }}</p>
            {% else %}
                 <p>This item has no category-specific details.</p>
            {% endif %}
        </div>
    </div>

    <h3 class="mt-4">Repair History</h3>

    {% for repair in repair_logs %}
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center {% if repair.is_active %}bg-warning{% else %}bg-light text-muted{% endif %}">
                <span>
                    {% if repair.is_active %}
                        Repair Started: {{ repair.start_date }}
                    {% else %}
                        Repair Started: {{ repair.start_date }} to Repair Completed: {{ repair.end_date|default:"N/A" }}
                    {% endif %}
                </span>
                <strong>{% if repair.is_active %}Status: ACTIVE{% else %}Status: Complete{% endif %}</strong>
            </div>
            <div class="card-body">
                <p><strong>Company:</strong> {{ repair.repair_company }}</p>
                <p><strong>Contact:</strong> {{ repair.contact_name }} ({{ repair.contact_number }}, {{ repair.contact_email }})</p>
                <p><strong>Description:</strong> {{ repair.description }}</p>
                <p><strong>Cost:</strong> ${{ repair.cost|default:"N/A" }}</p>
                
		<p><strong>Documents:</strong></p>
                <ul class="list-unstyled ms-3">
                    <li>
                        Document 1:
                        {% if repair.document1 %}
                            <a href="{{ repair.document1.url }}" target="_blank">View Document</a>
                        {% else %}
                            No document uploaded.
                        {% endif %}
                    </li>
                    <li>
                        Document 2:
                        {% if repair.document2 %}
                            <a href="{{ repair.document2.url }}" target="_blank">View Document</a>
                        {% else %}
                            No document uploaded.
                        {% endif %}
                    </li>
                    <li>
                        Document 3:
                        {% if repair.document3 %}
                            <a href="{{ repair.document3.url }}" target="_blank">View Document</a>
                        {% else %}
                            No document uploaded.
                        {% endif %}
                    </li>
                    <li>
                        Document 4:
                        {% if repair.document4 %}
                            <a href="{{ repair.document4.url }}" target="_blank">View Document</a>
                        {% else %}
                            No document uploaded.
                        {% endif %}
                    </li>
                    <li>
                        Document 5:
                        {% if repair.document5 %}
                            <a href="{{ repair.document5.url }}" target="_blank">View Document</a>
                        {% else %}
                            No document uploaded.
                        {% endif %}
                    </li>
                </ul>

                <p><strong>Expected Return:</strong> {{ repair.expected_return_date|default:"N/A" }}</p>

                {% if repair.is_active %}
                    <hr>
                    <form action="{% url 'complete_repair' repair.pk %}" method="post" 
                          onsubmit="return confirm('Are you sure you want to mark this repair as complete and return the item to the warehouse?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">Mark Repair as Complete</button>
                    </form>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <div class="alert alert-secondary">
            No repair history found for this item.
        </div>
    {% endfor %}

    <div class="mt-3">
        <a href="{% url 'item_list' %}">&laquo; Back to full list</a>
    </div>
    
{% endblock %}